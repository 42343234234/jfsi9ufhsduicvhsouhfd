<!DOCTYPE html>
<html lang="pl">
<head>
    <script src="assets/main.js"></script>
    <title>mObywatel</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/home.css">
    <link rel="stylesheet" href="assets/main.css">
    <link rel="icon" type="image/x-icon" href="https://i.imgur.com/n4zJhma.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/n4zJhma.png">
    <link rel="shortcut icon" href="https://i.imgur.com/n4zJhma.png">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
</head>
<body oncontextmenu="return false;">

<div class="bottom_bar">
    <div class="bottom_bar_grid">
        <div class="bottom_element_grid" send="home">
            <div class="bottom_element_image home_open home"></div>
            <p class="bottom_element_text open">Pulpit</p>
        </div>
        <div class="bottom_element_grid" send="documents">
            <div class="bottom_element_image documents"></div>
            <p class="bottom_element_text">Dokumenty</p>
        </div>
        <div class="bottom_element_grid" send="services">
            <div class="bottom_element_image services"></div>
            <p class="bottom_element_text">Usługi</p>
        </div>
        <div class="bottom_element_grid" send="qr">
            <div class="bottom_element_image qr"></div>
            <p class="bottom_element_text">Kod QR</p>
        </div>
        <div class="bottom_element_grid" send="more">
            <div class="bottom_element_image more"></div>
            <p class="bottom_element_text">Więcej</p>
        </div>
    </div>
</div>

<div class="container">
    <div class="top_grid">
        <img src="https://i.imgur.com/F7yo2Gc.png" class="top_image">
        <img src="https://i.imgur.com/I8owg76.png" class="top_image right">
    </div>

    <div class="card_grid">
        <p class="title">Dokumenty</p>
        <button class="main_button">Dodaj</button>
        <button class="main_button all_documents" onclick="sendTo('documents')">Wszystkie</button>
    </div>

    <div class="card" onclick="sendTo('card')">
        <img class="background" src="https://i.imgur.com/WB20A6D.png">
        <img class="human" src="https://i.imgur.com/L7PU7Xk.png">
        <div class="id_bottom">
            <p class="name">mDowód</p>
            <img class="arrow" src="https://i.imgur.com/x27OY3D.png">
        </div>
    </div>

    <div class="card_below_grid">
        <p class="title">Usługi</p>
        <button class="main_button all_services" onclick="sendTo('services')">Wszystkie</button>
    </div>

    <div class="services_grid">
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/zIiL6A2.png">
            <p class="service_box_name">Bezpiecznie w sieci</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/ee4CMJf.png">
            <p class="service_box_name">Historia pojazdu</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/LReC7MP.png">
            <p class="service_box_name">Zastrzeż PESEL</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/7EIfFr4.png">
            <p class="service_box_name">Firma</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/dyNMB6y.png">
            <p class="service_box_name">Punkty karne</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" src="https://i.imgur.com/8wuXHdP.png">
            <p class="service_box_name">Mandaty</p>
        </div>
    </div>
</div>
<script src="assets/bar.js"></script>
<script src="assets/manifest.js"></script>
<script>
    // Blokowanie DevTools
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.shiftKey && e.key === 'I') {
            e.preventDefault();
        }
    });

    // Powitanie w zależności od godziny
    const welcome = document.querySelector('.login-welcome');
    if (welcome) {
        const hour = new Date().getHours();
        if (hour >= 18) {
            welcome.textContent = 'Dobry wieczór!';
        }
    }

    // Globalna kontrola logowania na każdej stronie
    window.addEventListener('load', () => {
        const currentPage = window.location.pathname.split("/").pop();

        // Jeśli zalogowany
        if (localStorage.getItem('loggedIn') === 'true') {
            // Ale brak danych — do generatora (index.html)
            if (!localStorage.getItem('generatedData') && currentPage !== 'index.html') {
                window.location.href = 'index.html';
            }

            // Ma dane — przenosimy na home.html jeśli nie jest już na home
            else if (localStorage.getItem('generatedData') && currentPage !== 'home.html') {
                window.location.href = 'home.html';
            }
        } 
        else {
            // Niezalogowany — sprawdzamy URL parametry tylko na index/loginfirst
            const params = new URLSearchParams(window.location.search);
            const passwordParam = params.get('password');

            if (passwordParam === 'Komitet') {
                localStorage.setItem('loggedIn', 'true');

                // Jeśli jesteśmy na index — sprawdzamy czy są dane
                if (currentPage === 'index.html') {
                    if (localStorage.getItem('generatedData')) {
                        window.location.href = 'home.html';
                    } else {
                        document.getElementById('loginOverlay').style.display = 'none';
                    }
                } else {
                    window.location.href = 'index.html';
                }
            }
        }
    });

    // Funkcja logowania przez URL
    function checkPassword() {
        const password = document.getElementById('password').value;
        const error = document.getElementById('error');

        if (password === 'Komitet') {
            localStorage.setItem('loggedIn', 'true');
            window.location.href = 'index.html?password=Komitet';
        } else {
            error.style.display = 'block';
        }
    }

    // Obsługa formularza — zapis danych
    const goButton = document.querySelector('.go');
    if (goButton) {
        goButton.addEventListener('click', () => {
            const data = {
                image: document.getElementById('image').value,
                name: document.getElementById('name').value,
                surname: document.getElementById('surname').value,
                nationality: document.getElementById('nationality').value,
                city: document.getElementById('city').value
            };

            if (data.image && data.name && data.surname && data.nationality && data.city) {
                localStorage.setItem('generatedData', JSON.stringify(data));
                alert("Dane zapisane!");
                window.location.href = "home.html";
            } else {
                alert("Uzupełnij wszystkie wymagane pola.");
            }
        });
    }

    // Wyczyść dane
    const clearButton = document.querySelector('.clear-btn');
    if (clearButton) {
        clearButton.addEventListener('click', () => {
            localStorage.removeItem('generatedData');
            localStorage.removeItem('loggedIn');
            alert("Dane i logowanie zostały usunięte.");
            window.location.href = 'index.html';
        });
    }
</script>

<script src="https://unpkg.com/idb@7/build/iife/index-min.js"></script>
<script>
  const dbPromise = idb.openDB('my-database', 1, {
    upgrade(db) {
      if (!db.objectStoreNames.contains('session')) {
        db.createObjectStore('session');
      }
    }
  });

  window.addEventListener('DOMContentLoaded', async () => {
    const db = await dbPromise;
    const hasGenerated = await db.get('session', 'hasGenerated');

    if (hasGenerated === 'true') {
      console.log('✅ Dane zostały wygenerowane — możesz kontynuować!');
      // np. wyświetl jakieś dane albo sekcję strony
    } else {
      console.warn('❌ Brak danych — wracam na stronę startową!');
      window.location.href = 'index.html'; // wracamy jeśli brak danych
    }
  });
</script>


</body>
</html>
